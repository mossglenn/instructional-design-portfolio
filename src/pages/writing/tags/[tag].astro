---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import Layout from '@layouts/Layout.astro';
import PostCard from '@components/writing/PostCard.astro';
import { getAllTags, getPostsByTag, formatTagLabel } from '@utilities/writing';

export const getStaticPaths: GetStaticPaths = async () => {
  const tags = await getAllTags();
  return tags.map((tag) => ({
    params: { tag },
  }));
};

const { tag } = Astro.params;
const posts = await getPostsByTag(tag as string);
const tagLabel = formatTagLabel(tag as string);
const title = `${tagLabel} | Writing | Amos Glenn`;
const description = `All writing tagged with ${tagLabel}`;
---

<Layout title={title} description={description}>
  <main class="container mx-auto px-4 py-12 max-w-6xl">
    <!-- Back Link -->
    <a
      href="/writing"
      class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:underline mb-8"
    >
      <svg
        class="w-5 h-5 mr-2"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"
        />
      </svg>
      Back to Writing
    </a>

    <!-- Header -->
    <header class="mb-12 text-center">
      <div class="inline-flex items-center justify-center mb-4">
        <svg
          class="w-8 h-8 text-primary-600 dark:text-primary-400 mr-3"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
          />
        </svg>
        <h1 class="text-5xl font-bold text-gray-900 dark:text-gray-100">
          {tagLabel}
        </h1>
      </div>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        {posts.length} {posts.length === 1 ? 'post' : 'posts'} tagged with {tagLabel}
      </p>
    </header>

    <!-- Posts Grid -->    {posts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-xl text-gray-600 dark:text-gray-400">
          No posts found with this tag.
        </p>
      </div>
    ) : (
      <div class="grid gap-8 md:grid-cols-2">
        {posts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>
    )}
  </main>
</Layout>

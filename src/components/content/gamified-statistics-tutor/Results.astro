---
import IframeLearningObject from '@components/IframeLearningObject.astro';
import { learningObjects } from '@/data/learningObjects';

const defaultOpenId = learningObjects.find(lo => lo.defaultOpen)?.id ?? null;
---

<section class="project-results py-12 lg:pb-18 px-4 shadow-sm bg-neutral-200">
    <div class="max-w-screen-xl mx-auto">
        <h3
            class="pb-12 text-4xl tracking-tight font-extrabold text-neutral-900 text-center lg:text-left"
        >
            Try it Yourself
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-20">
            <div
                class="text-center lg:text-left bg-card px-6 py-6 border border-card-border rounded-lg shadow-lg"
            >
                <h4
                    class="text-2xl tracking-tight font-extrabold pb-2 text-primary-500"
                >
                    Escape Room
                </h4>
                <p class="text-base italic font-semibold mb-4">
                    Practice and learn complex statistics calculations to
                    uncover the secret code that unlocks the door.
                </p>
                <div
                    class="flex flex-col lg:flex-row w-full items-center gap-4 mb-1"
                >
                    <div class="shrink-0 group">
                        <a
                            href="/learning-objects/escape-room-learning-activity/index.html"
                            target="_blank"
                            rel="noopener"
                            class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border-b-2 border-neutral-400 bg-primary-600 text-neutral-50 group-hover:text-accent-200 transition shadow-sm group-hover:shadow-md shadow-neutral-400 group-hover:border-accent-400 group-hover:shadow-accent-400"
                        >
                            <svg
                                class="w-12 h-12 text-card group-hover:text-accent-200 transition"
                                aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                fill="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M20.337 3.664c.213.212.354.486.404.782.294 1.711.657 5.195-.906 6.76-1.77 1.768-8.485 5.517-10.611 6.683a.987.987 0 0 1-1.176-.173l-.882-.88-.877-.884a.988.988 0 0 1-.173-1.177c1.165-2.126 4.913-8.841 6.682-10.611 1.562-1.563 5.046-1.198 6.757-.904.296.05.57.191.782.404ZM5.407 7.576l4-.341-2.69 4.48-2.857-.334a.996.996 0 0 1-.565-1.694l2.112-2.111Zm11.357 7.02-.34 4-2.111 2.113a.996.996 0 0 1-1.69-.565l-.422-2.807 4.563-2.74Zm.84-6.21a1.99 1.99 0 1 1-3.98 0 1.99 1.99 0 0 1 3.98 0Z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-xl font-bold"
                                >Launch the Game</span
                            >
                        </a>
                    </div>
                    <p class="text-neutral-700 text-sm px-4">
                        Launch the interactive problem set in a new window to
                        experience the personalized, gamified tutor used in the
                        project.
                    </p>
                </div>
                <p class="text-xs text-neutral-500 mt-0 mb-4">
                    Click OK if your browser complains about not having access
                    to a LMS.
                </p>
                <a
                    href="/learning-objects/escape-room-learning-activity/index.html"
                    target="_blank"
                    rel="noopener"
                    class="group block"
                >
                    <div class="relative w-full">
                        <PlayIcon
                            class="absolute inset-0 w-1/2 m-auto opacity-0 group-hover:opacity-80 transition-opacity duration-200"
                            style={`--icon-field-color: hsla(0 0% 100% / 0.3); --icon-subject-color: hsla(0 0% 100% / 0.9);`}
                        />
                        <Image
                            src={EscapeRoomCover}
                            alt="Escape Room Cover"
                            class="w-full border-2 border-neutral-900 shadow-lg"
                        />
                    </div>
                </a>
            </div>

            <div
                class="text-center lg:text-left bg-card px-6 py-6 border border-card-border rounded-lg shadow-lg"
            >
                <h4
                    class="text-2xl tracking-tight font-extrabold pb-2 text-primary-500"
                >
                    The Biostatisticians Treasure
                </h4>
                <p class="text-base italic font-semibold mb-4">
                    Practice and learn probability calculations by searching for
                    a treasure hidden somewhere in the zoo.
                </p>

                <div
                    class="flex flex-col lg:flex-row w-full items-center gap-4 mb-1"
                >
                    <div class="shrink-0 group">
                        <a
                            href="/learning-objects/stats-zoo-learning-activity/index.html"
                            target="_blank"
                            rel="noopener"
                            class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border-b-2 border-neutral-400 bg-primary-600 text-neutral-50 group-hover:text-accent-200 transition shadow-sm group-hover:shadow-md shadow-neutral-400 group-hover:border-accent-400 group-hover:shadow-accent-400"
                        >
                            <svg
                                class="w-12 h-12 text-card group-hover:text-accent-200 transition"
                                aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                fill="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    fill-rule="evenodd"
                                    d="M20.337 3.664c.213.212.354.486.404.782.294 1.711.657 5.195-.906 6.76-1.77 1.768-8.485 5.517-10.611 6.683a.987.987 0 0 1-1.176-.173l-.882-.88-.877-.884a.988.988 0 0 1-.173-1.177c1.165-2.126 4.913-8.841 6.682-10.611 1.562-1.563 5.046-1.198 6.757-.904.296.05.57.191.782.404ZM5.407 7.576l4-.341-2.69 4.48-2.857-.334a.996.996 0 0 1-.565-1.694l2.112-2.111Zm11.357 7.02-.34 4-2.111 2.113a.996.996 0 0 1-1.69-.565l-.422-2.807 4.563-2.74Zm.84-6.21a1.99 1.99 0 1 1-3.98 0 1.99 1.99 0 0 1 3.98 0Z"
                                    clip-rule="evenodd"></path>
                            </svg>
                            <span class="text-xl font-bold"
                                >Launch the Game</span
                            >
                        </a>
                    </div>
                    <p class="text-neutral-700 text-sm px-4">
                        Launch the interactive problem set in a new window to
                        experience the personalized, gamified tutor used in the
                        project.
                    </p>
                </div>
                <p class="text-xs text-neutral-500 mt-0 mb-4">
                    Click OK if your browser complains about not having access
                    to a LMS.
                </p>
                <a
                    href="/learning-objects/stats-zoo-learning-activity/index.html"
                    target="_blank"
                    rel="noopener"
                    class="group block"
                >
                    <div class="relative w-full">
                        <PlayIcon
                            class="absolute inset-0 w-1/2 m-auto opacity-0 group-hover:opacity-80 transition-opacity duration-200"
                            style={`--icon-field-color: hsla(0 0% 0% / 0.3); --icon-subject-color: hsla(0 0% 0% / 0.9);`}
                        />
                        <Image
                            src={TreasureHuntCover}
                            alt="Treasure Hunt at the zoo"
                            class="w-full border-2 border-neutral-900 shadow-lg"
                        />
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>

<script>
  document.addEventListener("click", (e) => {
    const btn = e.target.closest?.("[data-lo-toggle]");
    if (!btn) return;
    e.preventDefault();

    const targetSel = btn.getAttribute("data-target");
    if (!targetSel) return;

    const panel = document.querySelector(targetSel);
    if (!panel) return;

    // helper: update all buttons that control this panel
    const setControlsFor = (targetSelector, isOpen) => {
      document.querySelectorAll(`[data-lo-toggle][data-target="${targetSelector}"]`).forEach((ctrl) => {
        ctrl.setAttribute("aria-expanded", isOpen ? "true" : "false");
        const label = ctrl.querySelector(".btn-label");
        if (label) label.textContent = isOpen ? "Hide" : "Start";
      });
    };

    const willOpen = panel.hasAttribute("hidden");

    // Close any other open embeds
    document.querySelectorAll(".lo-embed.is-open").forEach((open) => {
      if (open !== panel) {
        open.setAttribute("hidden", "true");
        open.classList.remove("is-open");
        const ctrl = document.querySelector(`[data-lo-toggle][data-target="#${open.id}"]`);
        if (ctrl) {
          ctrl.setAttribute("aria-expanded", "false");
          const lbl = ctrl.querySelector(".btn-label");
          if (lbl) lbl.textContent = "Start";
        }
      }
    });

    if (willOpen) {
      panel.removeAttribute("hidden");
      panel.classList.add("is-open");
      btn.setAttribute("aria-expanded", "true");
      setControlsFor(targetSel, true);
      panel.scrollIntoView({ behavior: "smooth", block: "start" });
      panel.querySelector("iframe")?.focus?.();
    } else {
      panel.setAttribute("hidden", "true");
      panel.classList.remove("is-open");
      btn.setAttribute("aria-expanded", "false");
      setControlsFor(targetSel, false);
    }
  });
</script>

<style>

  .lo-list { list-style: none; padding: 0; margin: 0; display: grid; gap: 1rem; }
  .lo-item { border: 1px solid hsl(0 0% 90%); border-radius: .75rem; padding: 1rem; }

  /* Grid with optional thumbnail column */
  .lo-row {
    display: grid;
    grid-template-columns: 260px 1fr auto;
    gap: 1rem;
    align-items: start;
  }
  .lo-row.no-thumb {
    grid-template-columns: 1fr auto;
  }

  .lo-thumb { width: 100%; max-width: 260px; }
  .lo-thumb__btn {
    display:block; width:100%; background:none; border:none; padding:0; cursor:pointer;
    border-radius:.25rem; overflow:hidden;
  }
  .lo-thumb img {
    width: 100%;
    height: 100%;
  aspect-ratio: 4 / 3;       /* changed from 16 / 9 */
    object-fit: cover;
    display: block;
  }

  .lo-meta { min-width: 0; }
  .lo-name { margin: 0; font-size: 1.05rem; }
  .lo-desc { margin: .35rem 0 0; color: hsl(0 0% 35%); font-size: .95rem; }

  .lo-actions { display: flex; gap: .5rem; flex-wrap: wrap; }

  .btn {
    appearance: none; border: 1px solid hsl(0 0% 80%);
    padding: .5rem .75rem; border-radius: .5rem; background: hsl(0 0% 98%);
    text-decoration: none; font-size: .9rem; line-height: 1;
  }
  .btn:hover { background: hsl(0 0% 94%); }
  .btn-secondary { background: hsl(0 0% 99%); }

  .lo-embed { margin-top: .75rem; }
  .lo-hide { margin-top: .5rem; }
  .link-like { background: none; border: none; padding: 0; text-decoration: underline; cursor: pointer; font-size: .9rem; }
</style>
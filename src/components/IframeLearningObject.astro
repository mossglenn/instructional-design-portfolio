---
/**
 * IframeLearningObject.astro
 * Props:
 *  - src (required): string path under /public (e.g., "/learning-objects/foo/index.html")
 *  - title?: string (iframe title for a11y)
 *  - height?: string (CSS length; default "72vh")
 *  - standalone?: boolean (append ?StandAlone=true; default true)
 */
export interface Props {
    src: string;
    title?: string;
    height?: string;
    standalone?: boolean;
}
const {
    src,
    title = 'Interactive learning object',
    height = '72vh',
    standalone = true,
} = Astro.props;

function buildSrc(raw: string): string {
    try {
        if (!standalone) return raw;
        if (raw.includes('?')) {
            return /(\?|&)StandAlone=/i.test(raw)
                ? raw
                : `${raw}&StandAlone=true`;
        }
        return `${raw}?StandAlone=true`;
    } catch {
        return raw;
    }
}
const iframeSrc = buildSrc(src);
---

<div class="lo">
    <div class="lo__toolbar">
        <a
            href={iframeSrc}
            target="_blank"
            rel="noopener"
            class="btn"
            aria-label="Open learning object in a new tab"
        >
            Open in new tab
        </a>
    </div>

    <div class="lo__frame">
        <iframe
            src={iframeSrc}
            title={title}
            allow="fullscreen"
            loading="eager"
            style={`width:100%;height:${height};border:0;display:block;`}
        ></iframe>
    </div>

    <div class="lo__fallback">
        <noscript>
            JavaScript is required to display this interactive content. You can
            <a href={iframeSrc} target="_blank" rel="noopener"
                >open it in a new tab</a
            >.
        </noscript>
        <p aria-live="polite">
            If the embed doesnâ€™t load, try
            <a href={iframeSrc} target="_blank" rel="noopener"
                >opening it in a new tab</a
            >.
        </p>
    </div>
</div>

<style>
    .btn {
        appearance: none;
        border: 1px solid hsl(0 0% 80%);
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
        background: hsl(0 0% 98%);
        text-decoration: none;
        font-size: 0.9rem;
        line-height: 1;
    }
    .btn:hover {
        background: hsl(0 0% 94%);
    }
    .lo__toolbar {
        display: flex;
        justify-content: flex-end;
        margin: 0.25rem 0 0.5rem;
    }
    .lo__fallback {
        margin-top: 0.5rem;
        font-size: 0.9rem;
        color: hsl(0 0% 35%);
    }
    .lo__fallback a {
        text-decoration: underline;
    }
</style>
